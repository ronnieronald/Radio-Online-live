<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/assets/fav.png" type="image/x-icon">
    <title>Radio Online</title>
    <style>
      :root {
        --primary: #ff00cc;
        --secondary: #333399;
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --text-color: #ffffff;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        color: var(--text-color);
      }

      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Contenedor Principal con efecto Glassmorphism */
      .player-container {
        position: relative;
        width: 350px;
        padding: 2rem;
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border-radius: 20px;
        border: 1px solid var(--glass-border);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        text-align: center;
        z-index: 10;
      }

      /* Arte del Álbum */
      .album-art {
        width: 200px;
        height: 200px;
        margin: 0 auto 1.5rem;
        border-radius: 50%;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        position: relative;
        transition: transform 0.5s ease;
      }

      .album-art img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .album-art.playing {
        animation: spin 10s linear infinite;
      }

      @keyframes spin {
        100% {
          transform: rotate(360deg);
        }
      }

      /* Metadatos */
      .track-info h2 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .track-info p {
        font-size: 1rem;
        opacity: 0.8;
        margin-bottom: 2rem;
        font-weight: 300;
      }

      /* Visualizador */
      canvas {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100px;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        opacity: 0.6;
        pointer-events: none;
      }

      /* Controles */
      .controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 1rem;
      }

      .btn {
        background: none;
        border: none;
        cursor: pointer;
        color: white;
        transition: transform 0.2s, color 0.2s;
      }

      .btn:hover {
        transform: scale(1.1);
        color: var(--primary);
      }

      .play-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .play-btn svg {
        width: 24px;
        height: 24px;
        fill: white;
      }

      /* Indicador de estado */
      .status-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 0, 0, 0.6);
        padding: 4px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
        100% {
          opacity: 1;
        }
      }

      /* Elementos decorativos de fondo */
      .circle {
        position: absolute;
        border-radius: 50%;
        background: linear-gradient(to right, var(--primary), var(--secondary));
        z-index: 1;
      }
      .c1 {
        width: 200px;
        height: 200px;
        top: 10%;
        left: 20%;
        filter: blur(80px);
      }
      .c2 {
        width: 300px;
        height: 300px;
        bottom: 10%;
        right: 20%;
        filter: blur(100px);
      }
    </style>
  </head>
  <body>
    <!-- Elementos de fondo para ambiente -->
    <div class="circle c1"></div>
    <div class="circle c2"></div>

    <div class="player-container">
      <div class="status-badge">
        <div class="status-dot"></div>
        LIVE
      </div>

      <div class="album-art" id="albumArt">
        <!-- Imagen por defecto -->
        <img src="https://picsum.photos/200/200?grayscale" alt="Album Art" />
      </div>

      <div class="track-info">
        <h2 id="trackTitle">Conectando...</h2>
        <p id="artistName">Radio Station</p>
      </div>

      <canvas id="visualizer"></canvas>

      <div class="controls">
        <button class="btn" id="volDown">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path
              fill="currentColor"
              d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"
            />
          </svg>
        </button>

        <button class="btn play-btn" id="playPauseBtn">
          <!-- Icono Play -->
          <svg id="playIcon" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z" />
          </svg>
          <!-- Icono Pause (oculto inicialmente) -->
          <svg id="pauseIcon" viewBox="0 0 24 24" style="display: none">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
          </svg>
        </button>

        <button class="btn" id="volUp">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path
              fill="currentColor"
              d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"
            />
          </svg>
        </button>
      </div>

      <!-- Elemento de audio oculto -->
      <!-- NOTA: Reemplaza 'src' con tu URL de streaming real (Icecast/Shoutcast) -->
      <!-- Usamos un stream de prueba público -->
      <audio
        id="audioPlayer"
        crossorigin="anonymous"
        src="https://play.radioking.io/radio-online3"
      ></audio>
    </div>

    <script>
      const audio = document.getElementById("audioPlayer");
      const playBtn = document.getElementById("playPauseBtn");
      const playIcon = document.getElementById("playIcon");
      const pauseIcon = document.getElementById("pauseIcon");
      const albumArt = document.getElementById("albumArt");
      const trackTitle = document.getElementById("trackTitle");
      const artistName = document.getElementById("artistName");
      const canvas = document.getElementById("visualizer");
      const ctx = canvas.getContext("2d");

      let isPlaying = false;
      let audioContext, analyser, source;

      // 1. Lógica de Reproducción
      playBtn.addEventListener("click", () => {
        if (!audioContext) {
          initAudioContext();
        }

        if (audio.paused) {
          audio.play();
          isPlaying = true;
          playIcon.style.display = "none";
          pauseIcon.style.display = "block";
          albumArt.classList.add("playing");
          // Resume context si estaba suspendido (política de navegadores)
          if (audioContext.state === "suspended") {
            audioContext.resume();
          }
        } else {
          audio.pause();
          isPlaying = false;
          playIcon.style.display = "block";
          pauseIcon.style.display = "none";
          albumArt.classList.remove("playing");
        }
      });

      // Control de Volumen
      document.getElementById("volUp").addEventListener("click", () => {
        if (audio.volume < 1) audio.volume = Math.min(1, audio.volume + 0.1);
      });
      document.getElementById("volDown").addEventListener("click", () => {
        if (audio.volume > 0) audio.volume = Math.max(0, audio.volume - 0.1);
      });

      // 2. Visualizador de Audio (Web Audio API)
      function initAudioContext() {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();

        // Conectar el audio al analizador
        source = audioContext.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioContext.destination);

        analyser.fftSize = 64; // Cantidad de barras
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        function animate() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          analyser.getByteFrequencyData(dataArray);

          const barWidth = (canvas.width / bufferLength) * 2.5;
          let barHeight;
          let x = 0;

          for (let i = 0; i < bufferLength; i++) {
            barHeight = dataArray[i] / 2; // Escalar altura

            // Color dinámico basado en la frecuencia
            ctx.fillStyle = `rgba(255, 0, 204, ${barHeight / 100})`;
            ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

            x += barWidth + 1;
          }

          if (isPlaying) requestAnimationFrame(animate);
        }
        animate();
      }

      // 3. Obtención de Metadatos Reales (RadioKing API)
      // Usamos la API de RadioKing correspondiente al slug "radio-online3" de tu URL.
      async function updateMetadata() {
        try {
          const response = await fetch(
            "https://api.radioking.io/widget/radio/radio-online3/track/current"
          );
          const data = await response.json();

          // Solo actualizamos si la canción cambió para evitar parpadeos
          if (trackTitle.innerText !== data.title) {
            trackTitle.style.opacity = 0;
            artistName.style.opacity = 0;

            setTimeout(() => {
              trackTitle.innerText = data.title || "Radio Online";
              artistName.innerText = data.artist || "En vivo";
              // Si la API trae cover lo usamos, sino una imagen por defecto
              document.querySelector("#albumArt img").src =
                data.cover || "https://picsum.photos/200/200?grayscale";

              trackTitle.style.opacity = 1;
              artistName.style.opacity = 1;
            }, 500);
          }
        } catch (error) {
          console.error("Error al cargar metadatos:", error);
        }
      }

      // Actualizar cada 10 segundos
      updateMetadata();
      setInterval(updateMetadata, 10000);
    </script>
  </body>
</html>
